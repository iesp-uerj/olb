---
params:
  ini: "2019-01-01"
  end: "2019-02-01"
  set_title: "Relatório de Acompanhamento"
  set_author: "Observatório do Legislativo Brasileiro"
  tema: "Economia"
title: "`r params$set_title`"
author: "`r params$set_author`"
output: 
  html_document:
    toc_float: true
    toc: true
    toc_depth: 1
    smooth_scroll: true
    number_sections: false
    theme: readable
    highlight: tango
    keep_md: true
    df_print: paged
---

```{r setup, include=FALSE}
# Opts
knitr::opts_chunk$set(echo = TRUE)

# Pacotes
library(highcharter)
library(tidyverse)
library(DT)

# Dados
props <- proposicoes(params$ini, params$end) %>%
  filter(tema == params$tema)
```

# Apresentação

Este é um relatório de acompanhamento de novas proposições (especificamente, PL, PLP, PEC e MPV). O objetivo dele é exibir de forma simples, com tabelas e visualizações interativas, projetos apresentados em um dado período e por tema na Câmara dos Deputados -- usando a classificação temática do [Centro de Documentação e Informação da Câmara](https://www2.camara.leg.br/a-camara/estruturaadm/diretorias/diretoria-legislativa/estrutura-1/cedi). 

Todos os dados são extraídos diretamente do [Portal de Dados Abertos da Câmara](https://dadosabertos.camara.leg.br/), que são atualizados diariamente. Para fazer esse trabalho, o pacote [olb](https://github.com/meirelesff) extrai os dados necessários, limpa e consolida as informações para, então, produzir automaticamente um documento final. Basta uma linha de código e poucos segundos para gerar um novo relatório. Exemplo:

```{r, eval=FALSE}
olb::gera_relatorio(ini = "2019-02-01", end = "2019-03-01", tema = "Defesa e Segurança")
```

O resultado é exatamente este *website*, que pode ser customizado para adequar texto e seções. Para escolher o tema de um relatório, basta modificar o argumento da função `gera_relatorio`, passando a ele o nome do tema desejado (i.g., `tema = "Educação"`). Uma lista com todos os temas disponibilizados pela Câmara segue abaixo:


Essa lista de temas também pode ser consultado por meio de uma função do pacote:

```{r}

```



Daqui até o fim do documento, segue um exemplo de seções que são geradas automaticamente.

# Proposições

No período entre `r format(as.Date(params$ini), "%d/%m/%Y")` e `r format(as.Date(params$end), "%d/%m/%Y")`, `r nrow(props)` proposições legislativas na área de `r params$tema` foram introduzidas. No gráfico abaixo, é possível visualizar o número de proposições introduzidas por data.
<br>
<br>

```{r echo=FALSE, message=FALSE, warning=FALSE}
x <- props %>%
  mutate(dataApresentacao = as.Date(dataApresentacao)) %>%
  group_by(dataApresentacao) %>%
  summarise(n = n())

highchart() %>% 
  hc_title(text = "Proposições introduzidas no período") %>%
  hc_subtitle(text = paste0("Tema: ", params$tema)) %>%
  hc_xAxis(categories = x$dataApresentacao) %>% 
  hc_add_series(name = "Proposições", data = x$n) %>%
  hc_colors(c("#4582ec")) %>%
  hc_credits(enabled = TRUE, # add credits
             text = "www.olb.org.br",
             href = "http://olb.org.br/")

```


# Detalhes das proposições {.tabset}

Nas abas abaixo, é possível consultar informações específicas das proposições por tipo (Projeto de Lei, Medida Provisória, etc).
<br>
<br>


## Projetos de Lei


```{r echo=FALSE, message=FALSE, warning=FALSE}
props %>%
  filter(siglaTipo == "PL") %>%
  mutate(prop = paste0("PL ", numero, "/", ano)) %>%
  mutate(data = format(as.Date(dataApresentacao), "%d/%m/%Y")) %>%
  mutate(urlInteiroTeor = paste0('<a href="', urlInteiroTeor, '" target="_blank">Link</a>')) %>%
  select(prop, data, ementa, urlInteiroTeor) %>%
  setNames(c("Proposição", "Data de apresentação", "Ementa", "Inteiro teor")) %>%
  datatable(rownames = F, escape = FALSE,
            extensions = 'Buttons',
            options = list(
  pageLength = 3,
  lengthMenu = c(5, 10, 15, 20),
  dom = 'Bfrtip',
  language = list(url = 'http://cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json'),
  buttons = c('excel', 'pdf')
))
```


## Medidas Provisórias


```{r echo=FALSE, message=FALSE, warning=FALSE}
props %>%
  filter(siglaTipo == "PEC") %>%
  mutate(prop = paste0("PEC ", numero, "/", ano)) %>%
  mutate(data = format(as.Date(dataApresentacao), "%d/%m/%Y")) %>%
  mutate(urlInteiroTeor = paste0('<a href="', urlInteiroTeor, '" target="_blank">Link</a>')) %>%
  select(prop, data, ementa, urlInteiroTeor) %>%
  setNames(c("Proposição", "Data de apresentação", "Ementa", "Inteiro teor")) %>%
  datatable(rownames = F, escape = FALSE,
            extensions = 'Buttons',
            options = list(
  pageLength = 3,
  lengthMenu = c(5, 10, 15, 20),
  dom = 'Bfrtip',
  language = list(url = 'http://cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json'),
  buttons = c('excel', 'pdf')
))
```


## Projetos de Lei Complementar


```{r echo=FALSE, message=FALSE, warning=FALSE}
props %>%
  filter(siglaTipo == "PLP") %>%
  mutate(prop = paste0("PLP ", numero, "/", ano)) %>%
  mutate(data = format(as.Date(dataApresentacao), "%d/%m/%Y")) %>%
  mutate(urlInteiroTeor = paste0('<a href="', urlInteiroTeor, '" target="_blank">Link</a>')) %>%
  select(prop, data, ementa, urlInteiroTeor) %>%
  setNames(c("Proposição", "Data de apresentação", "Ementa", "Inteiro teor")) %>%
  datatable(rownames = F, escape = FALSE,
            extensions = 'Buttons',
            options = list(
  pageLength = 3,
  lengthMenu = c(5, 10, 15, 20),
  dom = 'Bfrtip',
  language = list(url = 'http://cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json'),
  buttons = c('excel', 'pdf')
))
```


## Projeos de Emenda Constitucional


```{r echo=FALSE, message=FALSE, warning=FALSE}
props %>%
  filter(siglaTipo == "PEC") %>%
  mutate(prop = paste0("PEC ", numero, "/", ano)) %>%
  mutate(data = format(as.Date(dataApresentacao), "%d/%m/%Y")) %>%
  mutate(urlInteiroTeor = paste0('<a href="', urlInteiroTeor, '" target="_blank">Link</a>')) %>%
  select(prop, data, ementa, urlInteiroTeor) %>%
  setNames(c("Proposição", "Data de apresentação", "Ementa", "Inteiro teor")) %>%
  datatable(rownames = F, escape = FALSE,
            extensions = 'Buttons',
            options = list(
  pageLength = 3,
  lengthMenu = c(5, 10, 15, 20),
  dom = 'Bfrtip',
  language = list(url = 'http://cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json'),
  buttons = c('excel', 'pdf')
))
```


# Proposições salientes








